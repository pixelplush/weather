const e="https://api.pixelplush.dev/v1";let a="Stream Weather",n={},t={},o="",s=1920,r=1080,i=.5;window.setupGame=function(e,l,c){a=e,n=l,t=c,o=n.path||"",t.clouds=void 0===t.clouds||null===t.clouds?!t.overlay:"true"===t.clouds,i=void 0===t.volume||null===t.volume?0:parseInt(t.volume)/100,s=Math.min(window.innerWidth,1920),r=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){try{const a=(await fetch(`${o}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));if(t.channel&&a&&a.includes(t.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),n.requires)try{if(account=await fetch(`${e}/accounts`,{headers:{Twitch:t.oauth?t.oauth.replace("oauth:",""):void 0}}).then((e=>e.json())),account.error)throw"Login Error";if(!account.owned.includes(n.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}h.forEach((e=>{t[`${e}Time`]?u[e]=parseInt(t[`${e}Time`]):u[e]=5}))}catch(e){console.log(e)}if(Unicorn.Create("unicorn-display",{width:s,height:r,background:"transparent",init:x,update:k,channel:t.channel,username:t.oauth?t.channel:void 0,password:t.oauth?t.oauth.replace("oauth:",""):void 0,onCommand:g,onChat:_,wallTop:!1,wallBottom:!0,gravity:{x:0,y:1}}),ComfyJS.onCheer=w,ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await f();0!==e&&(l=e.session,setInterval((()=>{f()}),6e4));let a=await ComfyJS.GetChannelRewards(c,!0),n=Object.keys(d);for(let e=0;e<n.length;e++){let o=n[e];if(a.some((e=>e.title===o))){if(!t[h[e]]){let e=a.find((e=>e.title===o));e&&(await ComfyJS.DeleteChannelReward(c,e.id),await m(100))}}else if(h[e]in t)try{await ComfyJS.CreateChannelReward(c,{title:o,prompt:d[o].desc,cost:t[h[e]],is_enabled:!0,background_color:d[o].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,is_max_per_user_per_stream_enabled:!1,is_global_cooldown_enabled:!0,global_cooldown_seconds:d[o].cooldown,should_redemptions_skip_request_queue:!0}),await m(100)}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,a,n,t,o)=>{d[a]&&d[a].callback()},t.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then((e=>e.json())).catch((e=>({error:e})))}(t.oauth.replace("oauth:",""));c=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scopes.includes(a)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}();var l="";let c="";const h=["rainbow"];let u={};const d={"Rainbow!!!":{desc:"Colors colors everywhere!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{b()}}};async function m(e){return new Promise(((a,n)=>{setTimeout((()=>{a()}),e)}))}async function f(){return fetch(`${e}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:l,game:"weather",theme:a,channel:t.channel,players:[t.channel],count:1})}).then((e=>e.json()))}let p=0;async function g(e,a,n,t,o){if(!document.hidden){if((t.broadcaster||t.mod)&&"resetrainbow"===a){let e=await ComfyJS.GetChannelRewards(c,!0),a=Object.keys(d);for(let n=0;n<a.length;n++){let t=a[n],o=e.find((e=>e.title===t));o&&await ComfyJS.DeleteChannelReward(c,o.id)}location.reload()}if((t.broadcaster||t.mod)&&"deleterainbow"===a){let e=await ComfyJS.GetChannelRewards(c,!0),a=Object.keys(d);for(let n=0;n<a.length;n++){let t=a[n],o=e.find((e=>e.title===t));o&&await ComfyJS.DeleteChannelReward(c,o.id)}}(t.broadcaster||t.mod||t.vip)&&"rainbow"===a&&b()}}function _(e,a,n,t,o){document.hidden}function w(e,a,n,t,o){document.hidden}let y={},$={};function b(){Unicorn.PlaySound("sfx_rainbow",{volume:i}),v("rainbow",0)}function v(e,a){p++;let n="particle_"+p,t=Unicorn.AddObject(n,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:$[e],frames:y[e].slice(),loop:!1}},isStatic:!0,x:a,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(t.animations.anim.alpha=.25+.5*Math.random()),t.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(n)}),.25*$[e]*y[e].length*1e3)}let U=[];let L=[];let C=[];function x(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;for(let e=1;e<=11;e++){y[`heavy_rain_${e}`]=[],$[`heavy_rain_${e}`]=16/60;for(let a=0;a<12;a++)Unicorn.Load(`heavy_rain_${e}_${a}`,`${o}/assets/stream-weather/heavy_rain/heavy_rain_${e}/heavy_rain_${e}_${a+1}.png`),y[`heavy_rain_${e}`].push(`heavy_rain_${e}_${a}`)}y.lightning=[],$.lightning=16/60;for(let e=0;e<4;e++)Unicorn.Load(`lightning_${e}`,`${o}/assets/stream-weather/lightning/lightning${e+1}.png`),y.lightning.push(`lightning_${e}`);for(let e=1;e<=3;e++){y[`raindrop_${e}`]=[],$[`raindrop_${e}`]=16/60;for(let a=0;a<10;a++)Unicorn.Load(`raindrop_${e}_${a}`,`${o}/assets/stream-weather/raindrop/raindrop${e}/raindrop${e}_${a+1}.png`),y[`raindrop_${e}`].push(`raindrop_${e}_${a}`)}y.rainbow=[],$.rainbow=16/60;for(let e=0;e<39;e++)Unicorn.Load(`rainbow_${e}`,`${o}/assets/stream-weather/rainbow/rainbow${e}.png`),y.rainbow.push(`rainbow_${e}`);y.sunrays=[],$.sunrays=16/60;for(let e=0;e<40;e++)Unicorn.Load(`sunrays_${e}`,`${o}/assets/stream-weather/sunrays/sunrays${e}.png`),y.sunrays.push(`sunrays_${e}`);for(let e=0;e<7;e++)Unicorn.Load(`snowflake${e+1}`,`${o}/assets/game-parachute/christmas_theme/snowflake_${e+1}.png`);for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${o}/assets/game-parachute/spring_theme/petal${e+1}.png`);Unicorn.Load("leaf1",`${o}/assets/game-parachute/autumn_theme/leaf1.png`),Unicorn.Load("leaf2",`${o}/assets/game-parachute/autumn_theme/leaf2.png`),Unicorn.Load("leaf3",`${o}/assets/game-parachute/autumn_theme/leaf3.png`),Unicorn.Load("leaf4",`${o}/assets/game-parachute/autumn_theme/leaf4.png`),Unicorn.Load("leaf5",`${o}/assets/game-parachute/autumn_theme/leaf5.png`),Unicorn.Load("leaf6",`${o}/assets/game-parachute/autumn_theme/leaf6.png`),Unicorn.Load("leaf7",`${o}/assets/game-parachute/autumn_theme/leaf_gold.png`),Unicorn.Load("leaf8",`${o}/assets/game-parachute/autumn_theme/oak_gold.png`),Unicorn.Load("leaf9",`${o}/assets/game-parachute/autumn_theme/oak1.png`),Unicorn.Load("leaf10",`${o}/assets/game-parachute/autumn_theme/oak2.png`),Unicorn.Load("leaf11",`${o}/assets/game-parachute/autumn_theme/oak3.png`),Unicorn.Load("leaf12",`${o}/assets/game-parachute/autumn_theme/oak4.png`),Unicorn.Load("leaf13",`${o}/assets/game-parachute/autumn_theme/oak5.png`),Unicorn.Load("leaf14",`${o}/assets/game-parachute/autumn_theme/oak6.png`);for(let e=0;e<6;e++)Unicorn.Load(`hail_${e+1}`,`${o}/assets/stream-weather/hail/hail_blue/hail${e+1}.png`);for(let e=0;e<2;e++)Unicorn.Load(`sfx_thunder${e+1}`,`web/thunder${e+1}.mp3`);Unicorn.Load("sfx_rain","web/rain.mp3"),Unicorn.Load("sfx_rainbow","web/rainbow.mp3"),Unicorn.Load("sfx_sunshine","web/sunshine.mp3"),Unicorn.Load("sfx_heavyrain","web/heavyrain.mp3"),Unicorn.Load("sfx_wind","web/wind.mp3")}function k(e,a){const n=a/1e3;for(let e=0;e<C.length;e++){let a=C[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(C[e].name),C.splice(e--,1)):(C[e].x=2480*Math.sin(a)-100,C[e].y+=n/10*1080+C[e].offset/10+Math.sin(20*a+C[e].offset),C[e].angle=10*Math.cos(20*a)+60*C[e].offset)}for(let e=0;e<U.length;e++){let a=U[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(U[e].name),U.splice(e--,1)):(U[e].x+=U[e].velocity.x*n,U[e].y+=U[e].velocity.y*n+(n/10*1180+U[e].offset/10)+Math.sin(20*a+U[e].offset),U[e].angle=10*Math.cos(20*a)+60*U[e].offset)}let t=[];for(let e=0;e<L.length;e++){let a=L[e].progress+=n/10;a>=1?t.push(L[e].name):(L[e].x+=L[e].velocity.x*n,L[e].y+=L[e].velocity.y*n+(n/10*1180+L[e].offset/10)+Math.sin(20*a+L[e].offset),L[e].angle=10*Math.cos(20*a)+60*L[e].offset)}L=L.filter((e=>!t.includes(e.name)));for(let e=0;e<t.length;e++)Unicorn.RemoveBacklay(t[e])}