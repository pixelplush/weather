let e="Stream Weather",o={},n={},t="",a=1920,r=1080,s=.5;function i(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(i,l,c){e=i,o=l,n=c,t=o.path||"",n.clouds=void 0===n.clouds||null===n.clouds?!n.overlay:"true"===n.clouds,s=void 0===n.volume||null===n.volume?0:parseInt(n.volume)/100,a=Math.min(window.innerWidth,1920),r=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){try{const e=(await fetch(`${t}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));n.channel&&e&&e.includes(n.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1)}catch(e){console.log(e)}if(Unicorn.Create("unicorn-display",{width:a,height:r,background:"transparent",init:B,update:L,channel:n.channel,username:n.oauth?n.channel:void 0,password:n.oauth,onCommand:h,onChat:f,screenWalls:!1,gravity:{x:0,y:0}}),ComfyJS.onCheer=m,ComfyJS.onConnected=async(e,o,n)=>{if(n){let e=await ComfyJS.GetChannelRewards(l,!0),o=Object.keys(c);for(let n=0;n<o.length;n++){let t=o[n];e.some((e=>e.title===t))||await ComfyJS.CreateChannelReward(l,{title:t,prompt:c[t].desc,cost:c[t].cost,is_enabled:!0,background_color:c[t].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!0,global_cooldown_seconds:c[t].cooldown,should_redemptions_skip_request_queue:!0})}}},ComfyJS.onReward=(e,o,n,t)=>{c[o]&&c[o].callback()},n.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then((e=>e.json())).catch((e=>({error:e})))}(n.oauth);l=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((o=>e.scopes.includes(o)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}();let l="";const c={"Make It Rain!":{desc:"Bring the rains down from Africa!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{y(5)}},"HEAVY RAIN!":{desc:"Lots and strong rains",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{g(5)}},"Lightning BZZT!":{desc:"Flash of lightning!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{w()}},"Rainbow!!!":{desc:"Colors colors everywhere!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{_()}},"Make It Shine!!":{desc:"Let there be light!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{b()}},"Let It Snow!!!":{desc:"Wintry Fun!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{x(5)}},"HEAVY SNOW!!!":{desc:"It's a blizzard out here!",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{k(5)}},"Flower Power!":{desc:"Beautiful Cherry Blossoms!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{U(5)}}};let d=0;async function h(e,o,n,t,a){if(!document.hidden){if((t.broadcaster||t.mod)&&"resetweather"===o){let e=await ComfyJS.GetChannelRewards(l,!0),o=Object.keys(c);for(let n=0;n<o.length;n++){let t=o[n],a=e.find((e=>e.title===t));a&&await ComfyJS.DeleteChannelReward(l,a.id)}location.reload()}if((t.broadcaster||t.mod)&&"deleteweather"===o){let e=await ComfyJS.GetChannelRewards(l,!0),o=Object.keys(c);for(let n=0;n<o.length;n++){let t=o[n],a=e.find((e=>e.title===t));a&&await ComfyJS.DeleteChannelReward(l,a.id)}}(t.broadcaster||t.mod||t.vip)&&"rain"===o&&y(parseInt(n||5)),(t.broadcaster||t.mod||t.vip)&&"heavyrain"===o&&g(parseInt(n||5)),(t.broadcaster||t.mod||t.vip)&&"lightning"===o&&w(),(t.broadcaster||t.mod||t.vip)&&"rainbow"===o&&_(),(t.broadcaster||t.mod||t.vip)&&"sunrays"===o&&b(),(t.broadcaster||t.mod||t.vip)&&"snoww"===o&&x(5),(t.broadcaster||t.mod||t.vip)&&"heavysnow"===o&&k(5),(t.broadcaster||t.mod||t.vip)&&"blossoms"===o&&U(5)}}function f(e,o,n,t,a){document.hidden}function m(e,o,n,t,a){document.hidden}let u={},p={};function y(e){for(let o=0;o<e;o++)for(let e=0;e<30;e++)setTimeout((()=>{v("raindrop",i(1920))}),i(1e3)+1e3*o)}function w(){v("lightning",0);let e=i(3e3);setTimeout((()=>{Unicorn.PlaySound(`thunder${i(2)+1}`,{volume:1e3*s/(e+1e3)})}),e)}function g(e){for(let o=0;o<e;o++)for(let e=0;e<50;e++)setTimeout((()=>{v(`heavy_rain_${i(2)+6}`,i(3840)-960)}),i(1e3)+1e3*o)}function _(){v("rainbow",0)}function b(){v("sunrays",0),setTimeout((()=>{v("sunrays",0)}),.25*p.sunrays*u.sunrays.length*1e3)}function v(e,o){d++;let n="particle_"+d,t=Unicorn.AddObject(n,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:p[e],frames:u[e].slice(),loop:!1}},isStatic:!0,x:o,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(t.animations.anim.alpha=.5),t.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(n)}),.25*p[e]*u[e].length*1e3)}let $=[];function C(e,o=0){let n=i(10),t="snow_"+ ++d,a=Unicorn.AddBacklay(t,`snowflake${i(7)+1}`,i(3840)+o,-100,{scale:{x:2,y:2}});a.velocity=e||{x:0,y:0},a.name=t,a.progress=0,a.offset=n,$.push(a)}function x(e){for(let o=0;o<e;o++)for(let e=0;e<30;e++)setTimeout((()=>{C()}),i(1e3)+1e3*o);d++;let o=`snow_${d}`;Unicorn.AddParticles(o,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),setTimeout((()=>{Unicorn.RemoveParticles(o)}),1e3*e)}function k(e){for(let o=0;o<e;o++)for(let e=0;e<1e3;e++)setTimeout((()=>{C({x:500,y:500},-960)}),i(1e3)+1e3*o);d++;let o=`snow_${d}`;Unicorn.AddParticles(o,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",length:3840,angle:Math.PI/4,startColor:"#ffffff",endColor:"#ffffff",intensity:100,minSpeed:.5,maxSpeed:2,decay:15},-1920,-200),setTimeout((()=>{Unicorn.RemoveParticles(o)}),1e3*e)}let S=[];function E(e,o=0){let n=i(10),t="snow_"+ ++d,a=Unicorn.AddBacklay(t,`blossom${i(12)+1}`,i(3840)+o,-100,{scale:{x:2,y:2}});a.velocity=e||{x:0,y:0},a.name=t,a.progress=0,a.offset=n,S.push(a)}function U(e){for(let o=0;o<e;o++)for(let e=0;e<500;e++)setTimeout((()=>{E({x:100,y:100},-960)}),i(1e3)+1e3*o)}function B(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;for(let e=6;e<=7;e++){u[`heavy_rain_${e}`]=[],p[`heavy_rain_${e}`]=16/60;for(let o=0;o<12;o++)Unicorn.Load(`heavy_rain_${e}_${o}`,`${t}/assets/stream-weather/heavy_rain/heavy_rain_${e}/heavy_rain_${e}_${o+1}.png`),u[`heavy_rain_${e}`].push(`heavy_rain_${e}_${o}`)}u.lightning=[],p.lightning=16/60;for(let e=0;e<4;e++)Unicorn.Load(`lightning_${e}`,`${t}/assets/stream-weather/lightning/lightning${e+1}.png`),u.lightning.push(`lightning_${e}`);u.raindrop=[],p.raindrop=16/60;for(let e=0;e<10;e++)Unicorn.Load(`raindrop_${e}`,`${t}/assets/stream-weather/raindrop/raindrop${e+1}.png`),u.raindrop.push(`raindrop_${e}`);u.rainbow=[],p.rainbow=16/60;for(let e=0;e<26;e++)Unicorn.Load(`rainbow_${e}`,`${t}/assets/stream-weather/rainbow/rainbow${e}.png`),u.rainbow.push(`rainbow_${e}`);u.sunrays=[],p.sunrays=16/60;for(let e=0;e<40;e++)Unicorn.Load(`sunrays_${e}`,`${t}/assets/stream-weather/sunrays/sunrays${e}.png`),u.sunrays.push(`sunrays_${e}`);for(let e=0;e<7;e++)Unicorn.Load(`snowflake${e+1}`,`${t}/assets/game-parachute/christmas_theme/snowflake_${e+1}.png`);for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${t}/assets/game-parachute/spring_theme/petal${e+1}.png`);for(let e=0;e<2;e++)Unicorn.Load(`thunder${e+1}`,`web/thunder${e+1}.mp3`)}function L(e,o){const n=o/1e3;for(let e=0;e<$.length;e++){let o=$[e].progress+=n/10;o>=1?(Unicorn.RemoveBacklay($[e].name),$.splice(e--,1)):($[e].x+=$[e].velocity.x*n,$[e].y+=$[e].velocity.y*n+(n/10*1180+$[e].offset/10)+Math.sin(20*o+$[e].offset),$[e].angle=10*Math.cos(20*o)+60*$[e].offset)}for(let e=0;e<S.length;e++){let o=S[e].progress+=n/10;o>=1?(Unicorn.RemoveBacklay(S[e].name),S.splice(e--,1)):(S[e].x+=S[e].velocity.x*n,S[e].y+=S[e].velocity.y*n+(n/10*1180+S[e].offset/10)+Math.sin(20*o+S[e].offset),S[e].angle=10*Math.cos(20*o)+60*S[e].offset)}}