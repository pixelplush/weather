let e="Stream Weather",a={},o={},t="",n=1920,s=1080,r=.5;function i(e){return Math.floor(Math.random()*Math.floor(e))}async function l(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then((e=>e.json())).catch((e=>({error:e})))}async function c(e){return await fetch(`https://api.pixelplush.dev/v1/auth/refresh?token=${e}`).then((e=>e.json())).catch((e=>({error:e})))}window.setupGame=function(i,l,c){e=i,a=l,o=c,t=a.path||"",o.clouds=void 0===o.clouds||null===o.clouds?!o.overlay:"true"===o.clouds,r=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,n=Math.min(window.innerWidth,1920),s=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){try{const e=(await fetch(`${t}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));if(o.channel&&e&&e.includes(o.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),o.oauth&&(o.oauth=await async function(e,a){const o=localStorage.getItem("pixelplush_token"),t=localStorage.getItem("pixelplush_refresh");if(o){const e=await l(o);if(console.log("stored access token",e),e&&e.user_id&&e.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scopes.includes(a))))return o}if(t){const e=await c(t);if(console.log("stored refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scope.includes(a))))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}const n=await l(e);if(console.log("provided access token",n),n&&n.user_id&&n.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((e=>n.scopes.includes(e))))return localStorage.setItem("pixelplush_token",e),localStorage.setItem("pixelplush_refresh",a),e;if(a){const e=await c(a);if(console.log("provided refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scope.includes(a))))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}return console.log("no valid tokens"),null}(o.oauth.replace("oauth:",""),o.refreshToken)),a.requires)try{if(account=await fetch("https://stats.pixelplush.dev/v1/accounts",{headers:{Twitch:o.oauth?o.oauth.replace("oauth:",""):void 0}}).then((e=>e.json())),account.error)throw"Login Error";if(!account.owned.includes(a.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}u.forEach((e=>{o[`${e}Time`]?m[e]=parseInt(o[`${e}Time`]):m[e]=5}))}catch(e){console.log(e)}if(Unicorn.Create("unicorn-display",{width:n,height:s,background:"transparent",init:N,update:D,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth?o.oauth.replace("oauth:",""):void 0,onCommand:y,onChat:w,wallTop:!1,wallBottom:!0,gravity:{x:0,y:1}}),ComfyJS.onCheer=v,ComfyJS.onConnected=async(e,a,t)=>{if(t){let e=await g();0!==e&&(h=e.session,setInterval((()=>{g()}),6e4));let a=await ComfyJS.GetChannelRewards(d,!0),t=Object.keys(f);for(let e=0;e<t.length;e++){let n=t[e];if(a.some((e=>e.title===n))){if(!o[u[e]]){let e=a.find((e=>e.title===n));e&&(await ComfyJS.DeleteChannelReward(d,e.id),await p(100))}}else if(u[e]in o)try{await ComfyJS.CreateChannelReward(d,{title:n,prompt:f[n].desc,cost:o[u[e]],is_enabled:!0,background_color:f[n].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,is_max_per_user_per_stream_enabled:!1,is_global_cooldown_enabled:!0,global_cooldown_seconds:f[n].cooldown,should_redemptions_skip_request_queue:!0}),await p(100)}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,a,o,t,n)=>{f[a]&&f[a].callback()},o.oauth){let e=await l(o.oauth.replace("oauth:",""));d=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scopes.includes(a)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}();var h="";let d="";const u=["rain","heavyrain","lightning","rainbow","sunshine","snow","blizzard","blossoms","hail","leaf"];let m={};const f={"Make It Rain!":{desc:"Let raindrops fall",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{k(m.rain)}},"HEAVY RAIN!":{desc:"Lots and strong rains",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{U(m.heavyrain)}},"Lightning BZZT!":{desc:"Flash of lightning!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{x()}},"Rainbow!!!":{desc:"Colors colors everywhere!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{S()}},"Make It Shine!!":{desc:"Let there be light!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{C()}},"Let It Snow!!!":{desc:"Wintry Fun!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{M(m.snow)}},"HEAVY SNOW!!!":{desc:"It's a blizzard out here!",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{B(m.blizzard)}},"Flower Power!":{desc:"Beautiful Cherry Blossoms!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{R(m.blossoms)}},"Holy Hail!!":{desc:"Ice rocks from the sky!",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{A(m.hail)}},"Make It Leaf!":{desc:"Let leaves fall across the stream",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{z(m.leaf)}}};async function p(e){return new Promise(((a,o)=>{setTimeout((()=>{a()}),e)}))}async function g(){return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:h,game:"weather",theme:e,channel:o.channel,players:[o.channel],count:1})}).then((e=>e.json()))}let _=0;async function y(e,a,o,t,n){if(!document.hidden){if((t.broadcaster||t.mod)&&"resetweather"===a){let e=await ComfyJS.GetChannelRewards(d,!0),a=Object.keys(f);for(let o=0;o<a.length;o++){let t=a[o],n=e.find((e=>e.title===t));n&&await ComfyJS.DeleteChannelReward(d,n.id)}location.reload()}if((t.broadcaster||t.mod)&&"deleteweather"===a){let e=await ComfyJS.GetChannelRewards(d,!0),a=Object.keys(f);for(let o=0;o<a.length;o++){let t=a[o],n=e.find((e=>e.title===t));n&&await ComfyJS.DeleteChannelReward(d,n.id)}}(t.broadcaster||t.mod||t.vip)&&"rain"===a&&k(parseInt(o||5)),(t.broadcaster||t.mod||t.vip)&&"heavyrain"===a&&U(parseInt(o||5)),(t.broadcaster||t.mod||t.vip)&&"lightning"===a&&x(),(t.broadcaster||t.mod||t.vip)&&"rainbow"===a&&S(),(t.broadcaster||t.mod||t.vip)&&"sunrays"===a&&C(),(t.broadcaster||t.mod||t.vip)&&"snow"===a&&M(5),(t.broadcaster||t.mod||t.vip)&&"heavysnow"===a&&B(5),(t.broadcaster||t.mod||t.vip)&&"blossoms"===a&&R(5),(t.broadcaster||t.mod||t.vip)&&"leaves"===a&&z(5),(t.broadcaster||t.mod||t.vip)&&"hail"===a&&A(5)}}function w(e,a,o,t,n){document.hidden}function v(e,a,o,t,n){document.hidden}let b={},$={};function k(e){Unicorn.PlaySound("sfx_rain",{volume:r});for(let a=0;a<e;a++){for(let e=0;e<100;e++)setTimeout((()=>{L(`raindrop_${i(3)+1}`,i(1920))}),i(1e3)+1e3*a);a>0&&a%5==0&&setTimeout((()=>{Unicorn.PlaySound("sfx_rain",{volume:r})}),1e3*a-i(1e3))}}function x(){L("lightning",0);let e=i(3e3);setTimeout((()=>{Unicorn.PlaySound(`sfx_thunder${i(2)+1}`,{volume:1e3*r/(e+1e3)})}),e)}function U(e){Unicorn.PlaySound("sfx_heavyrain",{volume:r});for(let a=0;a<e;a++){for(let e=0;e<200;e++)setTimeout((()=>{L(`heavy_rain_${i(11)+1}`,i(3840)-960)}),i(1e3)+1e3*a);a>0&&a%5==0&&setTimeout((()=>{Unicorn.PlaySound("sfx_heavyrain",{volume:r})}),1e3*a-i(1e3))}}function S(){Unicorn.PlaySound("sfx_rainbow",{volume:r}),L("rainbow",0)}function C(){Unicorn.PlaySound("sfx_sunshine",{volume:r}),L("sunrays",0),setTimeout((()=>{L("sunrays",0)}),.25*$.sunrays*b.sunrays.length*1e3)}function L(e,a){_++;let o="particle_"+_,t=Unicorn.AddObject(o,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:$[e],frames:b[e].slice(),loop:!1}},isStatic:!0,x:a,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(t.animations.anim.alpha=.25+.5*Math.random()),t.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(o)}),.25*$[e]*b[e].length*1e3)}let T=[];function I(e,a=0){let o=i(10),t="snow_"+ ++_;const n=.5+.75*Math.random(),s=`snowflake${i(7)+1}`;let r=Unicorn.AddBacklay(t,s,i(3840)+a,-100,{scale:{x:2*n,y:2*n}});r.velocity=e||{x:0,y:0},r.name=t,r.progress=0,r.offset=o,T.push(r)}function M(e){for(let a=0;a<e;a++)for(let e=0;e<30;e++)setTimeout((()=>{I()}),i(1e3)+1e3*a);setTimeout((()=>{Unicorn.RemoveParticles(name)}),1e3*e)}function B(e){Unicorn.PlaySound("sfx_wind",{volume:r});for(let a=0;a<e;a++){for(let e=0;e<300;e++)setTimeout((()=>{I({x:500,y:500},-960)}),i(1e3)+1e3*a);a>0&&a%5==0&&setTimeout((()=>{Unicorn.PlaySound("sfx_wind",{volume:r})}),1e3*a-i(1e3))}setTimeout((()=>{Unicorn.RemoveParticles(name)}),1e3*e)}let E=[];function P(e,a=0){let o=i(10),t="blossom_"+ ++_;const n=.5+.75*Math.random();let s=Unicorn.AddBacklay(t,`blossom${i(12)+1}`,i(3840)+a,-100,{scale:{x:2*n,y:2*n}});s.velocity=e||{x:0,y:0},s.name=t,s.progress=0,s.offset=o,E.push(s)}function R(e){for(let a=0;a<e;a++)for(let e=0;e<300;e++)setTimeout((()=>{P({x:100,y:100},-960)}),i(1e3)+1e3*a)}async function j(){_++;let e=null,a=i(6)+1;e=Unicorn.AddObject("hailDrop_"+_,{type:"circle",sprite:`hail_${a}`,scale:{x:2,y:2},x:i(1.25*n),y:-100-i(50),z:100,radius:5}),e.restitution=0,e.friction=1,e.frictionStatic=1,e.frictionAir=0,e.sprite.alpha=.5,e.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("hailDrop_"+_,-12,20),setTimeout((()=>{Unicorn.RemoveObject(e.label)}),3e3)}function A(e){Unicorn.PlaySound("sfx_heavyrain",{volume:r});for(let a=0;a<e;a++){for(let e=0;e<100;e++)setTimeout((()=>{L(`heavy_rain_${i(11)+1}`,i(3840)-960)}),i(1e3)+1e3*a);for(let e=0;e<200;e++)setTimeout((()=>{j()}),i(1e3)+1e3*a);a>0&&a%5==0&&setTimeout((()=>{Unicorn.PlaySound("sfx_heavyrain",{volume:r})}),1e3*a-i(1e3))}}let O=[];function J(){let e=i(2160)-1080,a=i(10),o="leaf_"+ ++_;const t=.5+.75*Math.random();let n=Unicorn.AddBacklay(o,`leaf${i(14)+1}`,-100,e,{scale:{x:2*t,y:2*t}});n.name=o,n.progress=0,n.offset=a,O.push(n)}function z(e){for(let a=0;a<e;a++)for(let e=0;e<50;e++)setTimeout((()=>{J()}),i(2e3)+1e3*a)}function N(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;for(let e=1;e<=11;e++){b[`heavy_rain_${e}`]=[],$[`heavy_rain_${e}`]=16/60;for(let a=0;a<12;a++)Unicorn.Load(`heavy_rain_${e}_${a}`,`${t}/assets/stream-weather/heavy_rain/heavy_rain_${e}/heavy_rain_${e}_${a+1}.png`),b[`heavy_rain_${e}`].push(`heavy_rain_${e}_${a}`)}b.lightning=[],$.lightning=16/60;for(let e=0;e<4;e++)Unicorn.Load(`lightning_${e}`,`${t}/assets/stream-weather/lightning/lightning${e+1}.png`),b.lightning.push(`lightning_${e}`);for(let e=1;e<=3;e++){b[`raindrop_${e}`]=[],$[`raindrop_${e}`]=16/60;for(let a=0;a<10;a++)Unicorn.Load(`raindrop_${e}_${a}`,`${t}/assets/stream-weather/raindrop/raindrop${e}/raindrop${e}_${a+1}.png`),b[`raindrop_${e}`].push(`raindrop_${e}_${a}`)}b.rainbow=[],$.rainbow=16/60;for(let e=0;e<39;e++)Unicorn.Load(`rainbow_${e}`,`${t}/assets/stream-weather/rainbow/rainbow${e}.png`),b.rainbow.push(`rainbow_${e}`);b.sunrays=[],$.sunrays=16/60;for(let e=0;e<40;e++)Unicorn.Load(`sunrays_${e}`,`${t}/assets/stream-weather/sunrays/sunrays${e}.png`),b.sunrays.push(`sunrays_${e}`);for(let e=0;e<7;e++)Unicorn.Load(`snowflake${e+1}`,`${t}/assets/game-parachute/christmas_theme/snowflake_${e+1}.png`);for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${t}/assets/game-parachute/spring_theme/petal${e+1}.png`);Unicorn.Load("leaf1",`${t}/assets/game-parachute/autumn_theme/leaf1.png`),Unicorn.Load("leaf2",`${t}/assets/game-parachute/autumn_theme/leaf2.png`),Unicorn.Load("leaf3",`${t}/assets/game-parachute/autumn_theme/leaf3.png`),Unicorn.Load("leaf4",`${t}/assets/game-parachute/autumn_theme/leaf4.png`),Unicorn.Load("leaf5",`${t}/assets/game-parachute/autumn_theme/leaf5.png`),Unicorn.Load("leaf6",`${t}/assets/game-parachute/autumn_theme/leaf6.png`),Unicorn.Load("leaf7",`${t}/assets/game-parachute/autumn_theme/leaf_gold.png`),Unicorn.Load("leaf8",`${t}/assets/game-parachute/autumn_theme/oak_gold.png`),Unicorn.Load("leaf9",`${t}/assets/game-parachute/autumn_theme/oak1.png`),Unicorn.Load("leaf10",`${t}/assets/game-parachute/autumn_theme/oak2.png`),Unicorn.Load("leaf11",`${t}/assets/game-parachute/autumn_theme/oak3.png`),Unicorn.Load("leaf12",`${t}/assets/game-parachute/autumn_theme/oak4.png`),Unicorn.Load("leaf13",`${t}/assets/game-parachute/autumn_theme/oak5.png`),Unicorn.Load("leaf14",`${t}/assets/game-parachute/autumn_theme/oak6.png`);for(let e=0;e<6;e++)Unicorn.Load(`hail_${e+1}`,`${t}/assets/stream-weather/hail/hail_blue/hail${e+1}.png`);for(let e=0;e<2;e++)Unicorn.Load(`sfx_thunder${e+1}`,`web/thunder${e+1}.mp3`);Unicorn.Load("sfx_rain","web/rain.mp3"),Unicorn.Load("sfx_rainbow","web/rainbow.mp3"),Unicorn.Load("sfx_sunshine","web/sunshine.mp3"),Unicorn.Load("sfx_heavyrain","web/heavyrain.mp3"),Unicorn.Load("sfx_wind","web/wind.mp3")}function D(e,a){const o=a/1e3;for(let e=0;e<O.length;e++){let a=O[e].progress+=o/10;a>=1?(Unicorn.RemoveBacklay(O[e].name),O.splice(e--,1)):(O[e].x=2480*Math.sin(a)-100,O[e].y+=o/10*1080+O[e].offset/10+Math.sin(20*a+O[e].offset),O[e].angle=10*Math.cos(20*a)+60*O[e].offset)}for(let e=0;e<T.length;e++){let a=T[e].progress+=o/10;a>=1?(Unicorn.RemoveBacklay(T[e].name),T.splice(e--,1)):(T[e].x+=T[e].velocity.x*o,T[e].y+=T[e].velocity.y*o+(o/10*1180+T[e].offset/10)+Math.sin(20*a+T[e].offset),T[e].angle=10*Math.cos(20*a)+60*T[e].offset)}let t=[];for(let e=0;e<E.length;e++){let a=E[e].progress+=o/10;a>=1?t.push(E[e].name):(E[e].x+=E[e].velocity.x*o,E[e].y+=E[e].velocity.y*o+(o/10*1180+E[e].offset/10)+Math.sin(20*a+E[e].offset),E[e].angle=10*Math.cos(20*a)+60*E[e].offset)}E=E.filter((e=>!t.includes(e.name)));for(let e=0;e<t.length;e++)Unicorn.RemoveBacklay(t[e])}