const e="https://api.pixelplush.dev/v1";let a="Stream Weather",n={},o={},t="",r=1920,s=1080,i=.5;function l(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(e,l,c){a=e,n=l,o=c,t=n.path||"",o.clouds=void 0===o.clouds||null===o.clouds?!o.overlay:"true"===o.clouds,i=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,r=Math.min(window.innerWidth,1920),s=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){try{const a=(await fetch(`${t}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));if(o.channel&&a&&a.includes(o.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),n.requires)try{if(account=await fetch(`${e}/accounts`,{headers:{Twitch:o.oauth?o.oauth.replace("oauth:",""):void 0}}).then((e=>e.json())),account.error)throw"Login Error";if(!account.owned.includes(n.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}}catch(e){console.log(e)}if(Unicorn.Create("unicorn-display",{width:r,height:s,background:"transparent",init:O,update:j,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth?o.oauth.replace("oauth:",""):void 0,onCommand:p,onChat:_,wallTop:!1,wallBottom:!0,gravity:{x:0,y:1}}),ComfyJS.onCheer=g,ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await f();0!==e&&(c=e.session,setInterval((()=>{f()}),6e4));let a=await ComfyJS.GetChannelRewards(d,!0),n=Object.keys(u);for(let e=0;e<n.length;e++){let t=n[e];if(a.some((e=>e.title===t))){if(!o[h[e]]){let e=a.find((e=>e.title===t));e&&await ComfyJS.DeleteChannelReward(d,e.id)}}else o[h[e]]&&await ComfyJS.CreateChannelReward(d,{title:t,prompt:u[t].desc,cost:o[h[e]],is_enabled:!0,background_color:u[t].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!0,global_cooldown_seconds:u[t].cooldown,should_redemptions_skip_request_queue:!0})}}},ComfyJS.onReward=(e,a,n,o,t)=>{u[a]&&u[a].callback()},o.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then((e=>e.json())).catch((e=>({error:e})))}(o.oauth.replace("oauth:",""));d=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scopes.includes(a)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}();var c="";let d="";const h=["rain","heavyrain","lightning","rainbow","sunshine","snow","blizzard","blossoms","hail"],u={"Make It Rain!":{desc:"Bring the rains down from Africa!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{b(5)}},"HEAVY RAIN!":{desc:"Lots and strong rains",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{v(5)}},"Lightning BZZT!":{desc:"Flash of lightning!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{$()}},"Rainbow!!!":{desc:"Colors colors everywhere!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{U()}},"Make It Shine!!":{desc:"Let there be light!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{x()}},"Let It Snow!!!":{desc:"Wintry Fun!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{S(5)}},"HEAVY SNOW!!!":{desc:"It's a blizzard out here!",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{E(5)}},"Flower Power!":{desc:"Beautiful Cherry Blossoms!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{B(5)}},"Holy Hail!!":{desc:"Ice rocks from the sky!",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{I(5)}}};async function f(){return fetch(`${e}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:c,game:"weather",theme:a,channel:o.channel,players:[o.channel],count:1})}).then((e=>e.json()))}let m=0;async function p(e,a,n,o,t){if(!document.hidden){if((o.broadcaster||o.mod)&&"resetweather"===a){let e=await ComfyJS.GetChannelRewards(d,!0),a=Object.keys(u);for(let n=0;n<a.length;n++){let o=a[n],t=e.find((e=>e.title===o));t&&await ComfyJS.DeleteChannelReward(d,t.id)}location.reload()}if((o.broadcaster||o.mod)&&"deleteweather"===a){let e=await ComfyJS.GetChannelRewards(d,!0),a=Object.keys(u);for(let n=0;n<a.length;n++){let o=a[n],t=e.find((e=>e.title===o));t&&await ComfyJS.DeleteChannelReward(d,t.id)}}(o.broadcaster||o.mod||o.vip)&&"rain"===a&&b(parseInt(n||5)),(o.broadcaster||o.mod||o.vip)&&"heavyrain"===a&&v(parseInt(n||5)),(o.broadcaster||o.mod||o.vip)&&"lightning"===a&&$(),(o.broadcaster||o.mod||o.vip)&&"rainbow"===a&&U(),(o.broadcaster||o.mod||o.vip)&&"sunrays"===a&&x(),(o.broadcaster||o.mod||o.vip)&&"snoww"===a&&S(5),(o.broadcaster||o.mod||o.vip)&&"heavysnow"===a&&E(5),(o.broadcaster||o.mod||o.vip)&&"blossoms"===a&&B(5),(o.broadcaster||o.mod||o.vip)&&"leaves"===a&&function(e){for(let a=0;a<e;a++)for(let e=0;e<50;e++)setTimeout((()=>{R({x:100,y:100},-100-l(1920))}),l(1e3)+1e3*a)}(5),(o.broadcaster||o.mod||o.vip)&&"hail"===a&&I(5)}}function _(e,a,n,o,t){document.hidden}function g(e,a,n,o,t){document.hidden}let y={},w={};function b(e){Unicorn.PlaySound("sfx_rain",{volume:i});for(let a=0;a<e;a++)for(let e=0;e<100;e++)setTimeout((()=>{C(`raindrop_${l(3)+1}`,l(1920))}),l(1e3)+1e3*a)}function $(){C("lightning",0);let e=l(3e3);setTimeout((()=>{Unicorn.PlaySound(`sfx_thunder${l(2)+1}`,{volume:1e3*i/(e+1e3)})}),e)}function v(e){Unicorn.PlaySound("sfx_heavyrain",{volume:i});for(let a=0;a<e;a++)for(let e=0;e<200;e++)setTimeout((()=>{C(`heavy_rain_${l(11)+1}`,l(3840)-960)}),l(1e3)+1e3*a)}function U(){Unicorn.PlaySound("sfx_rainbow",{volume:i}),C("rainbow",0)}function x(){Unicorn.PlaySound("sfx_sunshine",{volume:i}),C("sunrays",0),setTimeout((()=>{C("sunrays",0)}),.25*w.sunrays*y.sunrays.length*1e3)}function C(e,a){m++;let n="particle_"+m,o=Unicorn.AddObject(n,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:w[e],frames:y[e].slice(),loop:!1}},isStatic:!0,x:a,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(o.animations.anim.alpha=.25+.5*Math.random()),o.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(n)}),.25*w[e]*y[e].length*1e3)}let L=[];function k(e,a=0){let n=l(10),o="snow_"+ ++m,t=Unicorn.AddBacklay(o,`snowflake${l(7)+1}`,l(3840)+a,-100,{scale:{x:2,y:2}});t.velocity=e||{x:0,y:0},t.name=o,t.progress=0,t.offset=n,L.push(t)}function S(e){for(let a=0;a<e;a++)for(let e=0;e<30;e++)setTimeout((()=>{k()}),l(1e3)+1e3*a);m++;let a=`snow_${m}`;Unicorn.AddParticles(a,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),setTimeout((()=>{Unicorn.RemoveParticles(a)}),1e3*e)}function E(e){Unicorn.PlaySound("sfx_wind",{volume:i});for(let a=0;a<e;a++)for(let e=0;e<300;e++)setTimeout((()=>{k({x:500,y:500},-960)}),l(1e3)+1e3*a);m++;let a=`snow_${m}`;Unicorn.AddParticles(a,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",length:3840,angle:Math.PI/4,startColor:"#ffffff",endColor:"#ffffff",intensity:100,minSpeed:.5,maxSpeed:2,decay:15},-1920,-200),setTimeout((()=>{Unicorn.RemoveParticles(a)}),1e3*e)}let M=[];function T(e,a=0){let n=l(10),o="blossom_"+ ++m,t=Unicorn.AddBacklay(o,`blossom${l(12)+1}`,l(3840)+a,-100,{scale:{x:2,y:2}});t.velocity=e||{x:0,y:0},t.name=o,t.progress=0,t.offset=n,M.push(t)}function B(e){for(let a=0;a<e;a++)for(let e=0;e<300;e++)setTimeout((()=>{T({x:100,y:100},-960)}),l(1e3)+1e3*a)}async function P(){m++;let e=null,a=l(6)+1;e=Unicorn.AddObject("hailDrop_"+m,{type:"circle",sprite:`hail_${a}`,scale:{x:2,y:2},x:l(1.25*r),y:-100-l(50),z:100,radius:5}),e.restitution=0,e.friction=1,e.frictionStatic=1,e.frictionAir=0,e.sprite.alpha=.5,e.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("hailDrop_"+m,-12,20),setTimeout((()=>{Unicorn.RemoveObject(e.label)}),3e3)}function I(e){Unicorn.PlaySound("sfx_heavyrain",{volume:i});for(let a=0;a<e;a++){for(let e=0;e<100;e++)setTimeout((()=>{C(`heavy_rain_${l(11)+1}`,l(3840)-960)}),l(1e3)+1e3*a);for(let e=0;e<200;e++)setTimeout((()=>{P()}),l(1e3)+1e3*a)}}let A=[];function R(e,a=0){let n=l(10),o="leaf_"+ ++m,t=Unicorn.AddBacklay(o,`leaf${l(14)+1}`,a,l(2160)-1080,{scale:{x:2,y:2}});t.velocity=e||{x:0,y:0},t.name=o,t.progress=0,t.offset=n,A.push(t)}function O(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;for(let e=1;e<=11;e++){y[`heavy_rain_${e}`]=[],w[`heavy_rain_${e}`]=16/60;for(let a=0;a<12;a++)Unicorn.Load(`heavy_rain_${e}_${a}`,`${t}/assets/stream-weather/heavy_rain/heavy_rain_${e}/heavy_rain_${e}_${a+1}.png`),y[`heavy_rain_${e}`].push(`heavy_rain_${e}_${a}`)}y.lightning=[],w.lightning=16/60;for(let e=0;e<4;e++)Unicorn.Load(`lightning_${e}`,`${t}/assets/stream-weather/lightning/lightning${e+1}.png`),y.lightning.push(`lightning_${e}`);for(let e=1;e<=3;e++){y[`raindrop_${e}`]=[],w[`raindrop_${e}`]=16/60;for(let a=0;a<10;a++)Unicorn.Load(`raindrop_${e}_${a}`,`${t}/assets/stream-weather/raindrop/raindrop${e}/raindrop${e}_${a+1}.png`),y[`raindrop_${e}`].push(`raindrop_${e}_${a}`)}y.rainbow=[],w.rainbow=16/60;for(let e=0;e<39;e++)Unicorn.Load(`rainbow_${e}`,`${t}/assets/stream-weather/rainbow/rainbow_new/rainbow${e}.png`),y.rainbow.push(`rainbow_${e}`);y.sunrays=[],w.sunrays=16/60;for(let e=0;e<40;e++)Unicorn.Load(`sunrays_${e}`,`${t}/assets/stream-weather/sunrays/sunrays${e}.png`),y.sunrays.push(`sunrays_${e}`);for(let e=0;e<7;e++)Unicorn.Load(`snowflake${e+1}`,`${t}/assets/game-parachute/christmas_theme/snowflake_${e+1}.png`);for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${t}/assets/game-parachute/spring_theme/petal${e+1}.png`);Unicorn.Load("leaf1",`${t}/assets/game-parachute/autumn_theme/leaf1.png`),Unicorn.Load("leaf2",`${t}/assets/game-parachute/autumn_theme/leaf2.png`),Unicorn.Load("leaf3",`${t}/assets/game-parachute/autumn_theme/leaf3.png`),Unicorn.Load("leaf4",`${t}/assets/game-parachute/autumn_theme/leaf4.png`),Unicorn.Load("leaf5",`${t}/assets/game-parachute/autumn_theme/leaf5.png`),Unicorn.Load("leaf6",`${t}/assets/game-parachute/autumn_theme/leaf6.png`),Unicorn.Load("leaf7",`${t}/assets/game-parachute/autumn_theme/leaf_gold.png`),Unicorn.Load("leaf8",`${t}/assets/game-parachute/autumn_theme/oak_gold.png`),Unicorn.Load("leaf9",`${t}/assets/game-parachute/autumn_theme/oak1.png`),Unicorn.Load("leaf10",`${t}/assets/game-parachute/autumn_theme/oak2.png`),Unicorn.Load("leaf11",`${t}/assets/game-parachute/autumn_theme/oak3.png`),Unicorn.Load("leaf12",`${t}/assets/game-parachute/autumn_theme/oak4.png`),Unicorn.Load("leaf13",`${t}/assets/game-parachute/autumn_theme/oak5.png`),Unicorn.Load("leaf14",`${t}/assets/game-parachute/autumn_theme/oak6.png`);for(let e=0;e<6;e++)Unicorn.Load(`hail_${e+1}`,`${t}/assets/stream-weather/hail/hail_blue/hail${e+1}.png`);for(let e=0;e<2;e++)Unicorn.Load(`sfx_thunder${e+1}`,`web/thunder${e+1}.mp3`);Unicorn.Load("sfx_rain","web/rain.mp3"),Unicorn.Load("sfx_rainbow","web/rainbow.mp3"),Unicorn.Load("sfx_sunshine","web/sunshine.mp3"),Unicorn.Load("sfx_heavyrain","web/heavyrain.mp3"),Unicorn.Load("sfx_wind","web/wind.mp3")}function j(e,a){const n=a/1e3;for(let e=0;e<A.length;e++){let a=A[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(A[e].name),A.splice(e--,1)):(A[e].x=2480*Math.sin(a)-100,A[e].y+=n/10*1080+A[e].offset/10+Math.sin(20*a+A[e].offset),A[e].angle=10*Math.cos(20*a)+60*A[e].offset)}for(let e=0;e<L.length;e++){let a=L[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(L[e].name),L.splice(e--,1)):(L[e].x+=L[e].velocity.x*n,L[e].y+=L[e].velocity.y*n+(n/10*1180+L[e].offset/10)+Math.sin(20*a+L[e].offset),L[e].angle=10*Math.cos(20*a)+60*L[e].offset)}let o=[];for(let e=0;e<M.length;e++){let a=M[e].progress+=n/10;a>=1?o.push(M[e].name):(M[e].x+=M[e].velocity.x*n,M[e].y+=M[e].velocity.y*n+(n/10*1180+M[e].offset/10)+Math.sin(20*a+M[e].offset),M[e].angle=10*Math.cos(20*a)+60*M[e].offset)}M=M.filter((e=>!o.includes(e.name)));for(let e=0;e<o.length;e++)Unicorn.RemoveBacklay(o[e])}